/**
 * Angularjs directive for french immmatriculation input
 * @version v1.0.0 - 2015-08-21
 * @link 
 * @author Christophe genin <genin.christophe@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("cg.immatriculation",[]).directive("cgImmatriculation",[function(){var a=["input","keyup","click","focus"],b=new RegExp("[A-Z]{1}"),c=new RegExp("[0-9]{1}"),d=function(a){var d="__-___-__",e=d.split(""),f=a.split(""),g="",h=0,i=[];return angular.forEach(e,function(a,d){if(f[d]){var e=angular.uppercase(""+f[d]);0!==d&&1!==d&&7!==d&&8!==d||!b.test(e)||(g+=e,h=d),3!==d&&4!==d&&5!==d||!c.test(e)||(g+=e,h=d)}g.length!==d+1&&(g+=a,"-"===a&&(h+1===d&&(h=d),i.push(d)))}),h++,{position:h,value:g,defaultMask:d,forbiddenPos:i,maxposition:d.length-1}},e=function(a){return a===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(a.type||a.href||~a.tabIndex)};return{require:"ngModel",restrict:"A",link:function(b,c,f,g){function h(){var a=c.val();a&&0!=a.length||(c.val(""),g.$setViewValue(""))}function i(a){if(!a)return 0;if(void 0!==a.selectionStart)return a.selectionStart;if(document.selection&&e(c[0])){a.focus();var b=document.selection.createRange();return b.moveStart("character",a.value?-a.value.length:0),b.text.length}return 0}function j(a,b){if(!a)return 0;if(0!==a.offsetWidth&&0!==a.offsetHeight)if(a.setSelectionRange)e(c[0])&&(a.focus(),a.setSelectionRange(b,b));else if(a.createTextRange){var d=a.createTextRange();d.collapse(!0),d.moveEnd("character",b),d.moveStart("character",b),d.select()}}function k(a){return a?void 0!==a.selectionStart?a.selectionEnd-a.selectionStart:document.selection?document.selection.createRange().text.length:0:0}function l(a){a=a||{};var b=a.which,e=a.type;if(16!==b&&91!==b){var f=c.val(),h=i(this)||0,l=o||0,m=h-l,n=d(f),q=p||0,s=k(this)>0,t=q>0,u=f.length<r.length||q&&f.length===r.length-q,v=b>=37&&40>=b&&a.shiftKey,w=37===b,x=46===b||"keyup"!==e&&u&&0===m&&!t,y=function(a){for(var b=0;b<n.forbiddenPos.length;b++){var c=n.forbiddenPos[b];if(c===a&&!x&&!w)return a+1}return a};if(!v&&(!s||"click"!==e&&"keyup"!==e))return c.val(n.value),g.$setViewValue(n.value),r=n.value.substring(0,n.position),n.defaultMask===n.value?void j(this,0):void(h<=n.position?j(this,y(h)):j(this,y(n.position)))}}function m(){q||(c.bind("blur",h),c.bind(a.join(" "),l),q=!0)}function n(){var a=g.$modelValue||"",b=d(a);return b.defaultMask!==b.value&&(c.val(valMasked.value),g.$setViewValue(valMasked.value)),m(),!0}var o,p,q=!1,r="";c.attr("placeholder","Immatriculation"),g.$render=function(){g.$viewValue?c.val(g.$viewValue):c.val("")},f.$observe("cgImmatriculation",n)}}}]);